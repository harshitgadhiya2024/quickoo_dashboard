<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver DataTable with Search and Filter</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- DataTables CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/datatables.net-bs5/1.13.6/dataTables.bootstrap5.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <style>
        .dataTables_wrapper {
            padding: 20px;
        }
        
        .table-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        
        .filter-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px 8px 0 0;
            border-bottom: 1px solid #dee2e6;
        }
        
        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            align-items: end;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .filter-group label {
            font-size: 0.9rem;
            font-weight: 500;
            color: #6c757d;
        }
        
        .filter-group select,
        .filter-group input {
            min-width: 180px;
            font-size: 0.9rem;
        }
        
        .filter-actions {
            display: flex;
            justify-content: flex-start;
            margin-top: 15px;
            gap: 10px;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-active { background-color: #d1edff; color: #0c5aa6; }
        .status-inactive { background-color: #f8d7da; color: #721c24; }
        .status-pending { background-color: #fff3cd; color: #856404; }
        .status-approved { background-color: #d4edda; color: #155724; }
        .status-suspended { background-color: #f8d7da; color: #721c24; }
        
        .assignment-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .assignment-true { 
            background-color: #d4edda; 
            color: #155724; 
            border: 1px solid #c3e6cb;
        }
        
        .assignment-false { 
            background-color: #f8d7da; 
            color: #721c24; 
            border: 1px solid #f5c6cb;
        }
        
        .table th {
            background-color: #f8f9fa;
            border-top: none;
            font-weight: 600;
            color: #495057;
            font-size: 0.85rem;
        }
        
        .table td {
            vertical-align: middle;
            font-size: 0.85rem;
        }
        
        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
        }
        
        .button-group {
            display: inline-flex;
            gap: 8px;
            align-items: center;
        }
        
        .driver-photo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #dee2e6;
            transition: transform 0.2s;
        }
        
        .driver-photo:hover {
            transform: scale(1.1);
            cursor: pointer;
        }
        
        .document-thumb {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            object-fit: cover;
            border: 1px solid #dee2e6;
            transition: transform 0.2s;
        }
        
        .document-thumb:hover {
            transform: scale(1.05);
            cursor: pointer;
        }
        
        .vehicle-images {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .vehicle-thumb {
            width: 35px;
            height: 35px;
            border-radius: 6px;
            object-fit: cover;
            border: 1px solid #dee2e6;
        }
        
        .expire-warning {
            background-color: #fff3cd;
            color: #856404;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
        }
        
        .expire-danger {
            background-color: #f8d7da;
            color: #721c24;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
        }
        
        .expire-good {
            background-color: #d4edda;
            color: #155724;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
        }
        
        .no-data-card {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 60px 20px;
            text-align: center;
            color: #6c757d;
        }
        
        .no-data-card h2 {
            color: #495057;
            margin-bottom: 10px;
        }
        
        /* Make table more compact for many columns */
        .table-responsive {
            font-size: 0.8rem;
        }
        
        .compact-cell {
            padding: 0.3rem !important;
            max-width: 120px;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="table-container">
                    <!-- Filter Section -->
                    <div class="filter-section">
                        <h5 class="mb-3">Driver Filter Options</h5>
                        <div class="filter-row">
                            <div class="filter-group">
                                <label for="statusFilter">Status</label>
                                <select id="statusFilter" class="form-select form-select-sm">
                                    <option value="">All Statuses</option>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                    <option value="pending">Pending</option>
                                    <option value="approved">Approved</option>
                                    <option value="suspended">Suspended</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="assignmentFilter">Assignment Status</label>
                                <select id="assignmentFilter" class="form-select form-select-sm">
                                    <option value="">All</option>
                                    <option value="assigned">Assigned</option>
                                    <option value="unassigned">Unassigned</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="pcoExpiryFilter">PCO Expiry</label>
                                <select id="pcoExpiryFilter" class="form-select form-select-sm">
                                    <option value="">All</option>
                                    <option value="expired">Expired</option>
                                    <option value="expiring_soon">Expiring Soon (30 days)</option>
                                    <option value="valid">Valid</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="vehicleExpiryFilter">Vehicle PCO Expiry</label>
                                <select id="vehicleExpiryFilter" class="form-select form-select-sm">
                                    <option value="">All</option>
                                    <option value="expired">Expired</option>
                                    <option value="expiring_soon">Expiring Soon (30 days)</option>
                                    <option value="valid">Valid</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="dateFromFilter">Created From</label>
                                <input type="date" id="dateFromFilter" class="form-control form-control-sm">
                            </div>
                            <div class="filter-group">
                                <label for="dateToFilter">Created To</label>
                                <input type="date" id="dateToFilter" class="form-control form-control-sm">
                            </div>
                            <div class="filter-group">
                                <label for="updatedFromFilter">Updated From</label>
                                <input type="date" id="updatedFromFilter" class="form-control form-control-sm">
                            </div>
                            <div class="filter-group">
                                <label for="updatedToFilter">Updated To</label>
                                <input type="date" id="updatedToFilter" class="form-control form-control-sm">
                            </div>
                        </div>
                        <div class="filter-actions">
                            <button id="resetFilters" class="btn btn-outline-secondary btn-sm">Reset Filters</button>
                            <button id="todayCreated" class="btn btn-info btn-sm">Today's Created</button>
                            <button id="todayUpdated" class="btn btn-success btn-sm">Today's Updated</button>
                            <button id="expiringDrivers" class="btn btn-warning btn-sm">Expiring Documents</button>
                        </div>
                    </div>
                    
                    <!-- DataTable -->
                    <div class="table-responsive">
                        <table id="driverTable" class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Driver Name</th>
                                    <th>Photo</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>PCO Licence</th>
                                    <th>National Insurance</th>
                                    <th>PCO Vehicle</th>
                                    <th>Car Registration</th>
                                    <th>PCO Expiry</th>
                                    <th>Vehicle Expiry</th>
                                    <th>Driving Licence</th>
                                    <th>Insurance</th>
                                    <th>Vehicle Photos</th>
                                    <th>Assigned</th>
                                    <th>Status</th>
                                    <th>Created At</th>
                                    <th>Updated At</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Sample data -->
                                <tr>
                                    <td>1</td>
                                    <td>John Smith</td>
                                    <td><a href="https://via.placeholder.com/150" target="_blank"><img src="https://via.placeholder.com/150" class="driver-photo" alt="Driver Photo"></a></td>
                                    <td class="compact-cell">john.smith@example.com</td>
                                    <td>+44 123 456 7890</td>
                                    <td><a href="https://via.placeholder.com/300x200" target="_blank"><img src="https://via.placeholder.com/300x200" class="document-thumb" alt="PCO Licence"></a></td>
                                    <td class="compact-cell">AB123456C</td>
                                    <td><a href="https://via.placeholder.com/300x200" target="_blank"><img src="https://via.placeholder.com/300x200" class="document-thumb" alt="PCO Vehicle"></a></td>
                                    <td class="compact-cell">ABC123XYZ</td>
                                    <td><span class="expire-good">2025-12-15</span></td>
                                    <td><span class="expire-warning">2025-08-20</span></td>
                                    <td><a href="https://via.placeholder.com/300x200" target="_blank"><img src="https://via.placeholder.com/300x200" class="document-thumb" alt="Driving Licence"></a></td>
                                    <td><a href="https://via.placeholder.com/300x200" target="_blank"><img src="https://via.placeholder.com/300x200" class="document-thumb" alt="Insurance"></a></td>
                                    <td>
                                        <div class="vehicle-images">
                                            <a href="https://via.placeholder.com/400x300" target="_blank"><img src="https://via.placeholder.com/400x300" class="vehicle-thumb" alt="Vehicle 1"></a>
                                            <a href="https://via.placeholder.com/400x300" target="_blank"><img src="https://via.placeholder.com/400x300" class="vehicle-thumb" alt="Vehicle 2"></a>
                                        </div>
                                    </td>
                                    <td><span class="assignment-badge assignment-true">Assigned</span></td>
                                    <td><span class="status-badge status-active">Active</span></td>
                                    <td>2025-06-29 12:53:50.986000</td>
                                    <td>2025-07-07 11:21:12.643000</td>
                                    <td>
                                        <div class="button-group">
                                            <div class="dropdown">
                                                <button class="btn btn-success dropdown-toggle btn-sm" type="button" data-bs-toggle="dropdown">
                                                    Active
                                                </button>
                                                <ul class="dropdown-menu">
                                                    <li><a class="dropdown-item" href="/driver-status-update?uid=1&status=active">Active</a></li>
                                                    <li><a class="dropdown-item" href="/driver-status-update?uid=1&status=inactive">Inactive</a></li>
                                                    <li><a class="dropdown-item" href="/driver-status-update?uid=1&status=suspended">Suspended</a></li>
                                                </ul>
                                            </div>
                                            <button class="btn btn-sm btn-warning edit-driver-btn" data-bs-toggle="modal" data-bs-target="#editdriver"
                                                data-id="1" data-drivername="John Smith" data-email="john.smith@example.com" 
                                                data-phone="+44 123 456 7890" data-pco_licence_number="https://via.placeholder.com/300x200"
                                                data-national_insurance_number="AB123456C" data-pco_vehicle_licence="https://via.placeholder.com/300x200"
                                                data-car_register_number="ABC123XYZ">
                                                <i class="bi bi-pencil"></i> Edit
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td>Sarah Johnson</td>
                                    <td><a href="https://via.placeholder.com/150" target="_blank"><img src="https://via.placeholder.com/150" class="driver-photo" alt="Driver Photo"></a></td>
                                    <td class="compact-cell">sarah.j@example.com</td>
                                    <td>+44 987 654 3210</td>
                                    <td><a href="https://via.placeholder.com/300x200" target="_blank"><img src="https://via.placeholder.com/300x200" class="document-thumb" alt="PCO Licence"></a></td>
                                    <td class="compact-cell">CD789012E</td>
                                    <td><a href="https://via.placeholder.com/300x200" target="_blank"><img src="https://via.placeholder.com/300x200" class="document-thumb" alt="PCO Vehicle"></a></td>
                                    <td class="compact-cell">DEF456UVW</td>
                                    <td><span class="expire-danger">2025-07-05</span></td>
                                    <td><span class="expire-good">2025-11-30</span></td>
                                    <td><a href="https://via.placeholder.com/300x200" target="_blank"><img src="https://via.placeholder.com/300x200" class="document-thumb" alt="Driving Licence"></a></td>
                                    <td><a href="https://via.placeholder.com/300x200" target="_blank"><img src="https://via.placeholder.com/300x200" class="document-thumb" alt="Insurance"></a></td>
                                    <td>
                                        <div class="vehicle-images">
                                            <a href="https://via.placeholder.com/400x300" target="_blank"><img src="https://via.placeholder.com/400x300" class="vehicle-thumb" alt="Vehicle 1"></a>
                                        </div>
                                    </td>
                                    <td><span class="assignment-badge assignment-false">Unassigned</span></td>
                                    <td><span class="status-badge status-pending">Pending</span></td>
                                    <td>2025-07-01 08:54:10.183000</td>
                                    <td>2025-07-01 08:54:10.183000</td>
                                    <td>
                                        <div class="button-group">
                                            <div class="dropdown">
                                                <button class="btn btn-warning dropdown-toggle btn-sm" type="button" data-bs-toggle="dropdown">
                                                    Pending
                                                </button>
                                                <ul class="dropdown-menu">
                                                    <li><a class="dropdown-item" href="/driver-status-update?uid=2&status=active">Active</a></li>
                                                    <li><a class="dropdown-item" href="/driver-status-update?uid=2&status=pending">Pending</a></li>
                                                    <li><a class="dropdown-item" href="/driver-status-update?uid=2&status=suspended">Suspended</a></li>
                                                </ul>
                                            </div>
                                            <button class="btn btn-sm btn-warning edit-driver-btn" data-bs-toggle="modal" data-bs-target="#editdriver"
                                                data-id="2" data-drivername="Sarah Johnson" data-email="sarah.j@example.com"
                                                data-phone="+44 987 654 3210" data-pco_licence_number="https://via.placeholder.com/300x200"
                                                data-national_insurance_number="CD789012E" data-pco_vehicle_licence="https://via.placeholder.com/300x200"
                                                data-car_register_number="DEF456UVW">
                                                <i class="bi bi-pencil"></i> Edit
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>3</td>
                                    <td>Mike Wilson</td>
                                    <td><a href="https://via.placeholder.com/150" target="_blank"><img src="https://via.placeholder.com/150" class="driver-photo" alt="Driver Photo"></a></td>
                                    <td class="compact-cell">mike.wilson@example.com</td>
                                    <td>+44 555 123 4567</td>
                                    <td><a href="https://via.placeholder.com/300x200" target="_blank"><img src="https://via.placeholder.com/300x200" class="document-thumb" alt="PCO Licence"></a></td>
                                    <td class="compact-cell">EF345678G</td>
                                    <td><a href="https://via.placeholder.com/300x200" target="_blank"><img src="https://via.placeholder.com/300x200" class="document-thumb" alt="PCO Vehicle"></a></td>
                                    <td class="compact-cell">GHI789RST</td>
                                    <td><span class="expire-good">2026-01-15</span></td>
                                    <td><span class="expire-good">2025-12-10</span></td>
                                    <td><a href="https://via.placeholder.com/300x200" target="_blank"><img src="https://via.placeholder.com/300x200" class="document-thumb" alt="Driving Licence"></a></td>
                                    <td><a href="https://via.placeholder.com/300x200" target="_blank"><img src="https://via.placeholder.com/300x200" class="document-thumb" alt="Insurance"></a></td>
                                    <td>
                                        <div class="vehicle-images">
                                            <a href="https://via.placeholder.com/400x300" target="_blank"><img src="https://via.placeholder.com/400x300" class="vehicle-thumb" alt="Vehicle 1"></a>
                                            <a href="https://via.placeholder.com/400x300" target="_blank"><img src="https://via.placeholder.com/400x300" class="vehicle-thumb" alt="Vehicle 2"></a>
                                            <a href="https://via.placeholder.com/400x300" target="_blank"><img src="https://via.placeholder.com/400x300" class="vehicle-thumb" alt="Vehicle 3"></a>
                                        </div>
                                    </td>
                                    <td><span class="assignment-badge assignment-true">Assigned</span></td>
                                    <td><span class="status-badge status-approved">Approved</span></td>
                                    <td>2025-06-30 15:31:41.040000</td>
                                    <td>2025-07-01 09:30:53.116000</td>
                                    <td>
                                        <div class="button-group">
                                            <div class="dropdown">
                                                <button class="btn btn-success dropdown-toggle btn-sm" type="button" data-bs-toggle="dropdown">
                                                    Approved
                                                </button>
                                                <ul class="dropdown-menu">
                                                    <li><a class="dropdown-item" href="/driver-status-update?uid=3&status=active">Active</a></li>
                                                    <li><a class="dropdown-item" href="/driver-status-update?uid=3&status=approved">Approved</a></li>
                                                    <li><a class="dropdown-item" href="/driver-status-update?uid=3&status=suspended">Suspended</a></li>
                                                </ul>
                                            </div>
                                            <button class="btn btn-sm btn-warning edit-driver-btn" data-bs-toggle="modal" data-bs-target="#editdriver"
                                                data-id="3" data-drivername="Mike Wilson" data-email="mike.wilson@example.com"
                                                data-phone="+44 555 123 4567" data-pco_licence_number="https://via.placeholder.com/300x200"
                                                data-national_insurance_number="EF345678G" data-pco_vehicle_licence="https://via.placeholder.com/300x200"
                                                data-car_register_number="GHI789RST">
                                                <i class="bi bi-pencil"></i> Edit
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    
    <!-- DataTables JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables.net/1.13.6/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables.net-bs5/1.13.6/dataTables.bootstrap5.min.js"></script>

    <script>
        $(document).ready(function() {
            // Check if DataTables is loaded
            if (typeof $.fn.DataTable === 'undefined') {
                console.error('DataTables not loaded properly');
                return;
            }

            // Initialize DataTable
            var table = $('#driverTable').DataTable({
                "pageLength": 10,
                "lengthMenu": [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]],
                "order": [[0, "desc"]], // Sort by ID descending
                "responsive": true,
                "autoWidth": false,
                "scrollX": true, // Enable horizontal scrolling for many columns
                "columnDefs": [
                    {
                        "targets": [2, 5, 7, 11, 12], // Image columns
                        "orderable": false,
                        "searchable": false,
                        "width": "60px"
                    },
                    {
                        "targets": [3], // Email column
                        "width": "160px"
                    },
                    {
                        "targets": [4], // Phone column
                        "width": "130px"
                    },
                    {
                        "targets": [6, 8], // National Insurance, Car Registration
                        "width": "120px"
                    },
                    {
                        "targets": [9, 10], // Expiry date columns
                        "width": "110px"
                    },
                    {
                        "targets": [13], // Vehicle photos
                        "orderable": false,
                        "searchable": false,
                        "width": "120px"
                    },
                    {
                        "targets": [14, 15], // Assigned, Status
                        "width": "90px"
                    },
                    {
                        "targets": [16, 17], // Created/Updated columns
                        "width": "140px"
                    },
                    {
                        "targets": [18], // Actions column
                        "orderable": false,
                        "searchable": false,
                        "width": "180px"
                    }
                ],
                "language": {
                    "search": "Search drivers:",
                    "lengthMenu": "Show _MENU_ drivers",
                    "info": "Showing _START_ to _END_ of _TOTAL_ drivers",
                    "infoEmpty": "No drivers found",
                    "infoFiltered": "(filtered from _MAX_ total drivers)",
                    "paginate": {
                        "first": "First",
                        "last": "Last",
                        "next": "Next",
                        "previous": "Previous"
                    }
                }
            });

            // Function to calculate days until expiry
            function getDaysUntilExpiry(dateString) {
                if (!dateString) return null;
                var expiryDate = new Date(dateString);
                var today = new Date();
                var timeDiff = expiryDate.getTime() - today.getTime();
                return Math.ceil(timeDiff / (1000 * 3600 * 24));
            }

            // Custom filtering function
            $.fn.dataTable.ext.search.push(
                function(settings, data, dataIndex) {
                    var status = $('#statusFilter').val();
                    var assignment = $('#assignmentFilter').val();
                    var pcoExpiry = $('#pcoExpiryFilter').val();
                    var vehicleExpiry = $('#vehicleExpiryFilter').val();
                    var dateFrom = $('#dateFromFilter').val();
                    var dateTo = $('#dateToFilter').val();
                    var updatedFrom = $('#updatedFromFilter').val();
                    var updatedTo = $('#updatedToFilter').val();
                    
                    var rowStatus = data[15] || ''; // Status column
                    var rowAssignment = data[14] || ''; // Assignment column
                    var rowPcoExpiry = data[9] || ''; // PCO Expiry column
                    var rowVehicleExpiry = data[10] || ''; // Vehicle Expiry column
                    var rowCreatedAt = data[16] || ''; // Created At column
                    var rowUpdatedAt = data[17] || ''; // Updated At column
                    
                    // Extract status from badge HTML
                    var statusMatch = rowStatus.match(/status-(\w+)/);
                    var actualStatus = statusMatch ? statusMatch[1] : '';
                    
                    // Extract assignment from badge HTML
                    var assignmentMatch = rowAssignment.match(/assignment-(\w+)/);
                    var actualAssignment = assignmentMatch ? assignmentMatch[1] : '';
                    
                    // Extract dates from expiry columns (remove HTML tags)
                    var pcoExpiryDate = rowPcoExpiry.replace(/<[^>]*>/g, '');
                    var vehicleExpiryDate = rowVehicleExpiry.replace(/<[^>]*>/g, '');
                    
                    // Status filter
                    if (status && actualStatus !== status) {
                        return false;
                    }
                    
                    // Assignment filter
                    if (assignment) {
                        if (assignment === 'assigned' && actualAssignment !== 'true') {
                            return false;
                        }
                        if (assignment === 'unassigned' && actualAssignment !== 'false') {
                            return false;
                        }
                    }
                    
                    // PCO Expiry filter
                    if (pcoExpiry && pcoExpiryDate) {
                        var pcoDaysUntilExpiry = getDaysUntilExpiry(pcoExpiryDate);
                        if (pcoDaysUntilExpiry !== null) {
                            switch (pcoExpiry) {
                                case 'expired':
                                    if (pcoDaysUntilExpiry >= 0) return false;
                                    break;
                                case 'expiring_soon':
                                    if (pcoDaysUntilExpiry < 0 || pcoDaysUntilExpiry > 30) return false;
                                    break;
                                case 'valid':
                                    if (pcoDaysUntilExpiry <= 30) return false;
                                    break;
                            }
                        }
                    }
                    
                    // Vehicle Expiry filter
                    if (vehicleExpiry && vehicleExpiryDate) {
                        var vehicleDaysUntilExpiry = getDaysUntilExpiry(vehicleExpiryDate);
                        if (vehicleDaysUntilExpiry !== null) {
                            switch (vehicleExpiry) {
                                case 'expired':
                                    if (vehicleDaysUntilExpiry >= 0) return false;
                                    break;
                                case 'expiring_soon':
                                    if (vehicleDaysUntilExpiry < 0 || vehicleDaysUntilExpiry > 30) return false;
                                    break;
                                case 'valid':
                                    if (vehicleDaysUntilExpiry <= 30) return false;
                                    break;
                            }
                        }
                    }
                    
                    // Created date range filter
                    if (dateFrom || dateTo) {
                        var createdDate = '';
                        if (rowCreatedAt) {
                            var dateTimeParts = rowCreatedAt.split(' ');
                            if (dateTimeParts.length >= 1) {
                                createdDate = dateTimeParts[0];
                            }
                        }
                        
                        if (dateFrom && createdDate && createdDate < dateFrom) {
                            return false;
                        }
                        
                        if (dateTo && createdDate && createdDate > dateTo) {
                            return false;
                        }
                    }
                    
                    // Updated date range filter
                    if (updatedFrom || updatedTo) {
                        var updatedDate = '';
                        if (rowUpdatedAt) {
                            var dateTimeParts = rowUpdatedAt.split(' ');
                            if (dateTimeParts.length >= 1) {
                                updatedDate = dateTimeParts[0];
                            }
                        }
                        
                        if (updatedFrom && updatedDate && updatedDate < updatedFrom) {
                            return false;
                        }
                        
                        if (updatedTo && updatedDate && updatedDate > updatedTo) {
                            return false;
                        }
                    }
                    
                    return true;
                }
            );

            // Filter event handlers
            $('#statusFilter, #assignmentFilter, #pcoExpiryFilter, #vehicleExpiryFilter, #dateFromFilter, #dateToFilter, #updatedFromFilter, #updatedToFilter').on('change', function() {
                table.draw();
            });

            // Reset filters
            $('#resetFilters').on('click', function() {
                $('#statusFilter').val('');
                $('#assignmentFilter').val('');
                $('#pcoExpiryFilter').val('');
                $('#vehicleExpiryFilter').val('');
                $('#dateFromFilter').val('');
                $('#dateToFilter').val('');
                $('#updatedFromFilter').val('');
                $('#updatedToFilter').val('');
                table.search('').draw();
            });

            // Quick filter for today's created drivers
            $('#todayCreated').on('click', function() {
                var today = new Date().toISOString().split('T')[0];
                $('#dateFromFilter').val(today);
                $('#dateToFilter').val(today);
                table.draw();
            });

            // Quick filter for today's updated drivers
            $('#todayUpdated').on('click', function() {
                var today = new Date().toISOString().split('T')[0];
                $('#updatedFromFilter').val(today);
                $('#updatedToFilter').val(today);
                table.draw();
            });

            // Quick filter for expiring documents
            $('#expiringDrivers').on('click', function() {
                $('#pcoExpiryFilter').val('expiring_soon');
                $('#vehicleExpiryFilter').val('expiring_soon');
                table.draw();
            });

            // Edit driver button handler
            $('.edit-driver-btn').on('click', function() {
                var driverData = {
                    id: $(this).data('id'),
                    drivername: $(this).data('drivername'),
                    email: $(this).data('email'),
                    phone: $(this).data('phone'),
                    pco_licence_number: $(this).data('pco_licence_number'),
                    national_insurance_number: $(this).data('national_insurance_number'),
                    pco_vehicle_licence: $(this).data('pco_vehicle_licence'),
                    car_register_number: $(this).data('car_register_number')
                };
                
                console.log('Edit driver:', driverData);
                alert('Edit driver: ' + driverData.drivername + ' (ID: ' + driverData.id + ')');
            });
        });
    </script>
</body>
</html>